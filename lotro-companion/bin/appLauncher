#!/bin/sh

# resolve links - $0 may be a softlink
PRG="$0"
while [ -h "$PRG" ] ; do
  ls=`ls -ld "$PRG"`
  link=`expr "$ls" : '.*-> \(.*\)$'`
  if expr "$link" : '.*/.*' > /dev/null; then
    PRG="$link"
  else
    PRG=`dirname "$PRG"`/"$link"
  fi
done

CURRENT_DIR=`pwd`
BIN_DIR=`dirname "${PRG}"`
SCRIPT_NAME=`basename "${PRG}" .sh`
CONF=${SCRIPT_NAME}.conf
DISTRIB_HOME=${BIN_DIR}/..

# Memory options
if [ "${JAVA_MAX_MEM}" == "" ]
then
	JAVA_MAX_MEM=64M
fi
if [ "${JAVA_MIN_MEM}" == "" ]
then
	JAVA_MIN_MEM=16M
fi

DEFAULT_JAVA_OPTS="-Xms${JAVA_MIN_MEM} -Xmx${JAVA_MAX_MEM} -Dcom.sun.management.jmxremote"

# Language
if [ "${LANGUAGE}" == "" ]
then
	# Default language setup (none=default system language)
	#LANGUAGE=en
	#LANGUAGE=fr
	LANGUAGE=""
fi
if [ "${LANGUAGE}" != "" ]
then
	DEFAULT_JAVA_OPTS="${DEFAULT_JAVA_OPTS} -Duser.language=${LANGUAGE}"
fi

DEFAULT_JAVA_DEBUG_OPTS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5005"

# Support for loading native libraries
#LD_LIBRARY_PATH=${LD_LIBRARY_PATH};jni

if [ "${JAVA_OPTS}" == "" ]
then
	JAVA_OPTS=${DEFAULT_JAVA_OPTS}
fi

if [ "${DISTRIB_DEBUG}" == "true" ]
then
	# Use the defaults if JAVA_DEBUG_OPTS was not set
	if [ "${JAVA_DEBUG_OPTS}" == "" ]
	then
		JAVA_DEBUG_OPTS=${DEFAULT_JAVA_DEBUG_OPTS}
	fi
	JAVA_OPTS="${JAVA_DEBUG_OPTS} ${JAVA_OPTS}"
fi

# Setup boot classpath
CLASSPATH=lib/classworlds-1.0.1.jar
# Setup boot options
BOOT_OPTS="-Dclassworlds.conf=conf/${CONF}"

# Execute the Java Virtual Machine
cd "${DISTRIB_HOME}"
exec java ${JAVA_OPTS} -classpath "${CLASSPATH}" ${BOOT_OPTS} org.codehaus.classworlds.Launcher "$@"

